# Kerberos (Port 88)

Kerberos is the authentication aspect of Active Directory, meaning it is responsible for verifying the validity of users and server data. When an invalid username is requested the server responds using the Kerberos error code **KRB5KDC_ERR_C_PRINCIPAL_UNKNOWN**, allowing us to determine that the username was invalid. Valid usernames will illicit either the **TGT** in a AS-REP response or the error **KRB5KDC_ERR_PREAUTH_REQUIRED**, indicating that the user is required to perform pre-authentication.
This means we'll be able to brute force Kerberos if we can obtain usernames from the server. I have used a tool **kerbrute** that I will refer to if we find some.

```bash
./kerbrute_linux_amd64 userenum -d blackfield.local --dc [domain.domain] users.txt -t 100
```

Kali has pre-installed tools (GetNPUsers.py) that allow us to exploit the Kerberos feature, ASREPRoasting. The above usernames indicate they are accounts that don't require pre-authentication, enabling us to retrieve a ticket-granting-ticket hash value to impersonate the user.

```bash
python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py [domain.domain] / -no-pass -usersfile newUser.txt

OR

python3 GetNPUsers.py htb.local/ -dc-ip $ip -request
```

Store hash and crack with john

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
john --show hash.txt
```

